<template>
  <require from="components/common/common"></require>
  <require from="components/common/blog-post"></require>
  <require from="components/common/cover-image.html"></require>
  <require from="components/editor/cover-edit"></require>
  <require from="components/editor/editor"></require>
  <require from="components/editor/menu"></require>
  <require from="components/editor/menu-item.html"></require>
  <require from="components/editor/image-upload"></require>
  <require from="components/editor/playlist-editor"></require>
  <require from="components/editor/playlist-timeline"></require>
  <require from="components/editor/tag-list"></require>
  <require from="components/player/player"></require>
  <require from="components/tracklist"></require>
  <require from="components/disqus"></require>
  <require from="styles/common/article.styl"></require>
  <require from="styles/editor/post-edit.styl"></require>
  <require from="styles/editor/tag-edit.styl"></require>
  <require from="styles/app.styl"></require>
  <require from="styles/post.styl"></require>
  <require from="styles/volume.styl"></require>

  <div class="edit-panel menu au-animate animate-slide-in-left animate-slide-out-left" if.bind="selectedTrack === undefined">
    <ul uk-accordion>
      <li>
        <a class="uk-accordion-title" href="#">Headline</a>
        <div class="uk-accordion-content">
          <input type="text" value.bind="post.headline">
        </div>
      </li>
      <li>
        <a class="uk-accordion-title" href="#">Cover</a>
        <div class="uk-accordion-content">
          <cover-edit></cover-edit>
        </div>
      </li>
      <li>
        <a class="uk-accordion-title" href="#">Images</a>
        <div class="uk-accordion-content">
          <image-upload></image-upload>
        </div>
      </li>
      <li>
        <a class="uk-accordion-title" href="#">Audio</a>
        <div class="uk-accordion-content">
        </div>
      </li>
      <li>
        <a class="uk-accordion-title" href="#">Text</a>
        <div class="uk-accordion-content">
          <textarea value.bind="post.text" rows="20" spellcheck="false"></textarea>
        </div>
      </li>
    </ul>
  </div>

  <div class="track-edit-panel menu au-animate animate-slide-in-right animate-slide-out-right" if.bind="selectedTrack !== undefined">
  <div>
    <div class="track-form-field">
      <label for="track-name">Name</label>
      <input id="track-name" type="text" value.bind="track.name">
    </div>
    <div class="track-form-field">
      <label for="track-artist">Artist</label>
      <input id="track-artist" type="text" value.bind="track.byArtist">
    </div>
    <div class="track-form-field">
      <label for="track-year">Year</label>
      <input id="track-year" type="number" value.bind="track.copyrightYear | integerFromInput">
    </div>
    <div class="track-form-field">
      <label for="track-minutes">Minutes</label>
      <input id="track-minutes" type="number" value.bind="track.duration.minutes | integerFromInput">
    </div>
    <div class="track-form-field">
      <label for="track-seconds">Seconds</label>
      <input id="track-seconds" type="number" value.bind="track.duration.seconds | integerFromInput" step="0.1">
    </div>
    <hr/>
    <button class="uk-button uk-button-default" click.delegate="removeTrack()">
      <i class="fal fa-trash"></i>
      Remove
    </button>
  </div>
  </div>

  <div class="timeline-edit-panel" if.bind="edit">
    <a class="post-edit-tab ${selectedTrack === undefined ? 'selected' : ''}" click.delegate="selectTrack()">
      <i class="fal fa-bars"></i>
    </a>
    <playlist-timeline playlist.bind="post" selected.bind="selectedTrack" select.call="selectTrack(index)"></playlist-timeline>
  </div>

  <blog-post class="au-animate" 
    color.bind="post.palette.dark"
    bg-color.bind="post.palette.primary"
    bg-image.bind="post.image"
    toggle-edit.call="toggleEdit()" 
    edit.bind="edit"
  >
    <h1 slot="title">
      <span>${post.headline}</span>
    </h1>
    
    <div slot="toolbar">
      <!--
      <div if.bind="edit" class="post-edit-toolbar au-animate animate-fade-in animate-fade-out">
        <menu>
          <menu-item title="Headline" icon="fal fa-heading">
            <div class="content">
              <input type="text" value.bind="post.headline" style="width: 100%"/>
            </div>
          </menu-item>
          <menu-item title="Image" icon="fal fa-image">
            <cover-edit></cover-edit>
          </menu-item>
          <menu-item title="Tags" icon="fal fa-tags">
            <div class="content tag-list-edit">
              <tag-list title="Genres" tags.bind="post.genres"></tag-list>
              <tag-list title="Keywords" tags.bind="post.keywords"></tag-list>
            </div>
          </menu-item>
          <menu-item title="Audio" icon="fal fa-cloud-music">
            <div class="content">
              <input id="audio-content-url" value.bind="post.audio.contentUrl" style="width: 100%">
            </div>
          </menu-item>
          <menu-item title="Playlist" icon="fal fa-album-collection">
            <playlist-editor data.bind="post"/>
          </menu-item>
          <menu-item title="Article" icon="fal fa-article">
            <editor value.bind="post.text"/>
          </menu-item>
          <menu-item title="Content" icon="fal fa-file-upload">
            <image-upload></image-upload>
          </menu-item>
        </menu>
      </div>
    -->
    </div>

    <section slot="cover-main">
      <cover-image src.bind="post.image"></cover-image>
      <div class="content cover-content">
        <player playlist.bind="post"></player>
      </div>
      <div class="content">
        <div class="info">
          <a href.bind="post.audio.contentUrl">
            <i class="fal fa-download"></i> Download
          </a>
        </div>
      </div>
    </section>

    <section slot="cover-side">
      <tracklist slot="side" playlist.bind="post"></tracklist>
    </section>

    <section slot="content-main">
      <div class="excerpt">
        <p>${post.description}</p>
      </div>
      <article innerhtml.bind="post.text"></article>
    </section>
            
    <section slot="content-side">
      <disqus identifier.bind="post._id" url.bind="url" title.bind="post.headline"></disqus>
    </section>
  </blog-post>
</template>
